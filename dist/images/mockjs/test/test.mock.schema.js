'use strict';

/* global require, chai, describe, before, it */
/* global window */
// 数据占位符定义（Data Placeholder Definition，DPD）
var expect = chai.expect;
var Mock, $, _;

describe('Schema', function () {
    before(function (done) {
        require(['mock', 'underscore', 'jquery'], function () {
            Mock = arguments[0];
            window.XMLHttpRequest = Mock.XHR;
            _ = arguments[1];
            $ = arguments[2];
            expect(Mock).to.not.equal(undefined);
            expect(_).to.not.equal(undefined);
            expect($).to.not.equal(undefined);
            done();
        });
    });

    function stringify(json) {
        return JSON.stringify(json /*, null, 4*/);
    }

    function doit(template, validator) {
        it('', function () {
            var schema = Mock.toJSONSchema(template);
            this.test.title = (stringify(template) || template.toString()) + ' => ' + stringify(schema);
            validator(schema);
        });
    }

    describe('Type', function () {
        doit(1, function (schema) {
            expect(schema.name).to.be.an('undefined');
            // expect(schema).to.not.have.property('name')
            expect(schema).to.have.property('type', 'number');
            for (var n in schema.rule) {
                expect(schema.rule[n]).to.be.null();
            }
        });
        doit(true, function (schema) {
            expect(schema.name).to.be.an('undefined');
            // expect(schema).to.not.have.property('name')
            expect(schema).to.have.property('type', 'boolean');
            for (var n in schema.rule) {
                expect(schema.rule[n]).to.be.null();
            }
        });
        doit('', function (schema) {
            expect(schema.name).to.be.an('undefined');
            // expect(schema).to.not.have.property('name')
            expect(schema).to.have.property('type', 'string');
            for (var n in schema.rule) {
                expect(schema.rule[n]).to.be.null();
            }
        });
        doit(function () {}, function (schema) {
            expect(schema.name).to.be.an('undefined');
            // expect(schema).to.not.have.property('name')
            expect(schema).to.have.property('type', 'function');
            for (var n in schema.rule) {
                expect(schema.rule[n]).to.be.null();
            }
        });
        doit(/\d/, function (schema) {
            expect(schema.name).to.be.an('undefined');
            // expect(schema).to.not.have.property('name')
            expect(schema).to.have.property('type', 'regexp');
            for (var n in schema.rule) {
                expect(schema.rule[n]).to.be.null();
            }
        });
        doit([], function (schema) {
            expect(schema.name).to.be.an('undefined');
            // expect(schema).to.not.have.property('name')
            expect(schema).to.have.property('type', 'array');
            for (var n in schema.rule) {
                expect(schema.rule[n]).to.be.null();
            }
            expect(schema).to.have.property('items').with.length(0);
        });
        doit({}, function (schema) {
            expect(schema.name).to.be.an('undefined');
            // expect(schema).to.not.have.property('name')
            expect(schema).to.have.property('type', 'object');
            for (var n in schema.rule) {
                expect(schema.rule[n]).to.be.null();
            }
            expect(schema).to.have.property('properties').with.length(0);
        });
    });

    describe('Object', function () {
        doit({
            a: {
                b: {
                    c: {
                        d: {}
                    }
                }
            }
        }, function (schema) {
            expect(schema.name).to.be.an('undefined');
            // expect(schema).to.not.have.property('name')
            expect(schema).to.have.property('type', 'object');

            var properties;

            // root.properties
            properties = schema.properties;
            expect(properties).to.with.length(1);
            expect(properties[0]).to.have.property('name', 'a');
            expect(properties[0]).to.have.property('type', 'object');

            // root.a.properties
            properties = properties[0].properties;
            expect(properties).to.with.length(1);
            expect(properties[0]).to.have.property('name', 'b');
            expect(properties[0]).to.have.property('type', 'object');

            // root.a.b.properties
            properties = properties[0].properties;
            expect(properties).to.with.length(1);
            expect(properties[0]).to.have.property('name', 'c');
            expect(properties[0]).to.have.property('type', 'object');

            // root.a.b.c.properties
            properties = properties[0].properties;
            expect(properties).to.with.length(1);
            expect(properties[0]).to.have.property('name', 'd');
            expect(properties[0]).to.have.property('type', 'object');

            // root.a.b.c.d.properties
            properties = properties[0].properties;
            expect(properties).to.with.length(0);
        });
    });

    describe('Array', function () {
        doit([[['foo', 'bar']]], function (schema) {
            expect(schema.name).to.be.an('undefined');
            // expect(schema).to.not.have.property('name')
            expect(schema).to.have.property('type', 'array');

            var items;

            // root.items
            items = schema.items;
            expect(items).to.with.length(1);
            expect(items[0]).to.have.property('type', 'array');

            // root[0].items
            items = items[0].items;
            expect(items).to.with.length(1);
            expect(items[0]).to.have.property('type', 'array');

            // root[0][0].items
            items = items[0].items;
            expect(items).to.with.length(2);
            expect(items[0]).to.have.property('type', 'string');
            expect(items[1]).to.have.property('type', 'string');
        });
    });

    describe('String Rule', function () {
        doit({
            'string|1-10': '★'
        }, function (schema) {
            expect(schema.name).to.be.an('undefined');
            // expect(schema).to.not.have.property('name')
            expect(schema).to.have.property('type', 'object');

            var properties;
            // root.properties
            properties = schema.properties;
            expect(properties).to.with.length(1);
            expect(properties[0]).to.have.property('type', 'string');
            expect(properties[0].rule).to.have.property('min', 1);
            expect(properties[0].rule).to.have.property('max', 10);
        });
        doit({
            'string|3': 'value'
        }, function (schema) {
            expect(schema.name).to.be.an('undefined');
            // expect(schema).to.not.have.property('name')
            expect(schema).to.have.property('type', 'object');

            var properties;
            // root.properties
            properties = schema.properties;
            expect(properties).to.with.length(1);
            expect(properties[0]).to.have.property('type', 'string');
            expect(properties[0].rule).to.have.property('min', 3);
            expect(properties[0].rule.max).to.be.an('undefined');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QubW9jay5zY2hlbWEuanMiXSwibmFtZXMiOlsiZXhwZWN0IiwiY2hhaSIsIk1vY2siLCIkIiwiXyIsImRlc2NyaWJlIiwiYmVmb3JlIiwiZG9uZSIsInJlcXVpcmUiLCJhcmd1bWVudHMiLCJ3aW5kb3ciLCJYTUxIdHRwUmVxdWVzdCIsIlhIUiIsInRvIiwibm90IiwiZXF1YWwiLCJ1bmRlZmluZWQiLCJzdHJpbmdpZnkiLCJqc29uIiwiSlNPTiIsImRvaXQiLCJ0ZW1wbGF0ZSIsInZhbGlkYXRvciIsIml0Iiwic2NoZW1hIiwidG9KU09OU2NoZW1hIiwidGVzdCIsInRpdGxlIiwidG9TdHJpbmciLCJuYW1lIiwiYmUiLCJhbiIsImhhdmUiLCJwcm9wZXJ0eSIsIm4iLCJydWxlIiwibnVsbCIsIndpdGgiLCJsZW5ndGgiLCJhIiwiYiIsImMiLCJkIiwicHJvcGVydGllcyIsIml0ZW1zIiwibWF4Il0sIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0E7QUFDQTtBQUNBLElBQUlBLFNBQVNDLEtBQUtELE1BQWxCO0FBQ0EsSUFBSUUsSUFBSixFQUFVQyxDQUFWLEVBQWFDLENBQWI7O0FBRUFDLFNBQVMsUUFBVCxFQUFtQixZQUFXO0FBQzFCQyxXQUFPLFVBQVNDLElBQVQsRUFBZTtBQUNsQkMsZ0JBQVEsQ0FBQyxNQUFELEVBQVMsWUFBVCxFQUF1QixRQUF2QixDQUFSLEVBQTBDLFlBQVc7QUFDakROLG1CQUFPTyxVQUFVLENBQVYsQ0FBUDtBQUNBQyxtQkFBT0MsY0FBUCxHQUF3QlQsS0FBS1UsR0FBN0I7QUFDQVIsZ0JBQUlLLFVBQVUsQ0FBVixDQUFKO0FBQ0FOLGdCQUFJTSxVQUFVLENBQVYsQ0FBSjtBQUNBVCxtQkFBT0UsSUFBUCxFQUFhVyxFQUFiLENBQWdCQyxHQUFoQixDQUFvQkMsS0FBcEIsQ0FBMEJDLFNBQTFCO0FBQ0FoQixtQkFBT0ksQ0FBUCxFQUFVUyxFQUFWLENBQWFDLEdBQWIsQ0FBaUJDLEtBQWpCLENBQXVCQyxTQUF2QjtBQUNBaEIs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QWVILEtBL0JEO0FBaUNILENBdE1EIiwiZmlsZSI6InRlc3QubW9jay5zY2hlbWEuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgcmVxdWlyZSwgY2hhaSwgZGVzY3JpYmUsIGJlZm9yZSwgaXQgKi9cbi8qIGdsb2JhbCB3aW5kb3cgKi9cbi8vIOaVsOaNruWNoOS9jeespuWumuS5ie+8iERhdGEgUGxhY2Vob2xkZXIgRGVmaW5pdGlvbu+8jERQRO+8iVxudmFyIGV4cGVjdCA9IGNoYWkuZXhwZWN0XG52YXIgTW9jaywgJCwgX1xuXG5kZXNjcmliZSgnU2NoZW1hJywgZnVuY3Rpb24oKSB7XG4gICAgYmVmb3JlKGZ1bmN0aW9uKGRvbmUpIHtcbiAgICAgICAgcmVxdWlyZShbJ21vY2snLCAndW5kZXJzY29yZScsICdqcXVlcnknXSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBNb2NrID0gYXJndW1lbnRzWzBdXG4gICAgICAgICAgICB3aW5kb3cuWE1MSHR0cFJlcXVlc3QgPSBNb2NrLlhIUlxuICAgICAgICAgICAgXyA9IGFyZ3VtZW50c1sxXVxuICAgICAgICAgICAgJCA9IGFyZ3VtZW50c1syXVxuICAgICAgICAgICAgZXhwZWN0KE1vY2spLnRvLm5vdC5lcXVhbCh1bmRlZmluZWQpXG4gICAgICAgICAgICBleHBlY3QoXykudG8ubm90LmVxdWFsKHVuZGVmaW5lZClcbiAgICAgICAgICAgIGV4cGVjdCgkKS50by5ub3QuZXF1YWwodW5kZWZpbmVkKVxuICAgICAgICAgICAgZG9uZSgpXG4gICAgICAgIH0pXG4gICAgfSlcblxuICAgIGZ1bmN0aW9uIHN0cmluZ2lmeShqc29uKSB7XG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShqc29uIC8qLCBudWxsLCA0Ki8gKVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGRvaXQodGVtcGxhdGUsIHZhbGlkYXRvcikge1xuICAgICAgICBpdCgnJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgc2NoZW1hID0gTW9jay50b0pTT05TY2hlbWEodGVtcGxhdGUpXG4gICAgICAgICAgICB0aGlzLnRlc3QudGl0bGUgPSAoc3RyaW5naWZ5KHRlbXBsYXRlKSB8fCB0ZW1wbGF0ZS50b1N0cmluZygpKSArICcgPT4gJyArIHN0cmluZ2lmeShzY2hlbWEpXG4gICAgICAgICAgICB2YWxpZGF0b3Ioc2NoZW1hKVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIGRlc2NyaWJlKCdUeXBlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIGRvaXQoMSwgZnVuY3Rpb24oc2NoZW1hKSB7XG4gICAgICAgICAgICBleHBlY3Qoc2NoZW1hLm5hbWUpLnRvLmJlLmFuKCd1bmRlZmluZWQnKVxuICAgICAgICAgICAgICAgIC8vIGV4cGVjdChzY2hlbWEpLnRvLm5vdC5oYXZlLnByb3BlcnR5KCduYW1lJylcbiAgICAgICAgICAgIGV4cGVjdChzY2hlbWEpLnRvLmhhdmUucHJvcGVydHkoJ3R5cGUnLCAnbnVtYmVyJylcbiAgICAgICAgICAgIGZvciAodmFyIG4gaW4gc2NoZW1hLnJ1bGUpIHtcbiAgICAgICAgICAgICAgICBleHBlY3Qoc2NoZW1hLnJ1bGVbbl0pLnRvLmJlLm51bGwoKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICBkb2l0KHRydWUsIGZ1bmN0aW9uKHNjaGVtYSkge1xuICAgICAgICAgICAgZXhwZWN0KHNjaGVtYS5uYW1lKS50by5iZS5hbigndW5kZWZpbmVkJylcbiAgICAgICAgICAgICAgICAvLyBleHBlY3Qoc2NoZW1hKS50by5ub3QuaGF2ZS5wcm9wZXJ0eSgnbmFtZScpXG4gICAgICAgICAgICBleHBlY3Qoc2NoZW1hKS50by5oYXZlLnByb3BlcnR5KCd0eXBlJywgJ2Jvb2xlYW4nKVxuICAgICAgICAgICAgZm9yICh2YXIgbiBpbiBzY2hlbWEucnVsZSkge1xuICAgICAgICAgICAgICAgIGV4cGVjdChzY2hlbWEucnVsZVtuXSkudG8uYmUubnVsbCgpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIGRvaXQoJycsIGZ1bmN0aW9uKHNjaGVtYSkge1xuICAgICAgICAgICAgZXhwZWN0KHNjaGVtYS5uYW1lKS50by5iZS5hbigndW5kZWZpbmVkJylcbiAgICAgICAgICAgICAgICAvLyBleHBlY3Qoc2NoZW1hKS50by5ub3QuaGF2ZS5wcm9wZXJ0eSgnbmFtZScpXG4gICAgICAgICAgICBleHBlY3Qoc2NoZW1hKS50by5oYXZlLnByb3BlcnR5KCd0eXBlJywgJ3N0cmluZycpXG4gICAgICAgICAgICBmb3IgKHZhciBuIGluIHNjaGVtYS5ydWxlKSB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KHNjaGVtYS5ydWxlW25dKS50by5iZS5udWxsKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgZG9pdChmdW5jdGlvbigpIHt9LCBmdW5jdGlvbihzY2hlbWEpIHtcbiAgICAgICAgICAgIGV4cGVjdChzY2hlbWEubmFtZSkudG8uYmUuYW4oJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICAgICAgLy8gZXhwZWN0KHNjaGVtYSkudG8ubm90LmhhdmUucHJvcGVydHkoJ25hbWUnKVxuICAgICAgICAgICAgZXhwZWN0KHNjaGVtYSkudG8uaGF2ZS5wcm9wZXJ0eSgndHlwZScsICdmdW5jdGlvbicpXG4gICAgICAgICAgICBmb3IgKHZhciBuIGluIHNjaGVtYS5ydWxlKSB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KHNjaGVtYS5ydWxlW25dKS50by5iZS5udWxsKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgZG9pdCgvXFxkLywgZnVuY3Rpb24oc2NoZW1hKSB7XG4gICAgICAgICAgICBleHBlY3Qoc2NoZW1hLm5hbWUpLnRvLmJlLmFuKCd1bmRlZmluZWQnKVxuICAgICAgICAgICAgICAgIC8vIGV4cGVjdChzY2hlbWEpLnRvLm5vdC5oYXZlLnByb3BlcnR5KCduYW1lJylcbiAgICAgICAgICAgIGV4cGVjdChzY2hlbWEpLnRvLmhhdmUucHJvcGVydHkoJ3R5cGUnLCAncmVnZXhwJylcbiAgICAgICAgICAgIGZvciAodmFyIG4gaW4gc2NoZW1hLnJ1bGUpIHtcbiAgICAgICAgICAgICAgICBleHBlY3Qoc2NoZW1hLnJ1bGVbbl0pLnRvLmJlLm51bGwoKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICBkb2l0KFtdLCBmdW5jdGlvbihzY2hlbWEpIHtcbiAgICAgICAgICAgIGV4cGVjdChzY2hlbWEubmFtZSkudG8uYmUuYW4oJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICAgICAgLy8gZXhwZWN0KHNjaGVtYSkudG8ubm90LmhhdmUucHJvcGVydHkoJ25hbWUnKVxuICAgICAgICAgICAgZXhwZWN0KHNjaGVtYSkudG8uaGF2ZS5wcm9wZXJ0eSgndHlwZScsICdhcnJheScpXG4gICAgICAgICAgICBmb3IgKHZhciBuIGluIHNjaGVtYS5ydWxlKSB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KHNjaGVtYS5ydWxlW25dKS50by5iZS5udWxsKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGV4cGVjdChzY2hlbWEpLnRvLmhhdmUucHJvcGVydHkoJ2l0ZW1zJykud2l0aC5sZW5ndGgoMClcbiAgICAgICAgfSlcbiAgICAgICAgZG9pdCh7fSwgZnVuY3Rpb24oc2NoZW1hKSB7XG4gICAgICAgICAgICBleHBlY3Qoc2NoZW1hLm5hbWUpLnRvLmJlLmFuKCd1bmRlZmluZWQnKVxuICAgICAgICAgICAgICAgIC8vIGV4cGVjdChzY2hlbWEpLnRvLm5vdC5oYXZlLnByb3BlcnR5KCduYW1lJylcbiAgICAgICAgICAgIGV4cGVjdChzY2hlbWEpLnRvLmhhdmUucHJvcGVydHkoJ3R5cGUnLCAnb2JqZWN0JylcbiAgICAgICAgICAgIGZvciAodmFyIG4gaW4gc2NoZW1hLnJ1bGUpIHtcbiAgICAgICAgICAgICAgICBleHBlY3Qoc2NoZW1hLnJ1bGVbbl0pLnRvLmJlLm51bGwoKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZXhwZWN0KHNjaGVtYSkudG8uaGF2ZS5wcm9wZXJ0eSgncHJvcGVydGllcycpLndpdGgubGVuZ3RoKDApXG4gICAgICAgIH0pXG5cbiAgICB9KVxuXG4gICAgZGVzY3JpYmUoJ09iamVjdCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICBkb2l0KHtcbiAgICAgICAgICAgIGE6IHtcbiAgICAgICAgICAgICAgICBiOiB7XG4gICAgICAgICAgICAgICAgICAgIGM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGQ6IHt9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGZ1bmN0aW9uKHNjaGVtYSkge1xuICAgICAgICAgICAgZXhwZWN0KHNjaGVtYS5uYW1lKS50by5iZS5hbigndW5kZWZpbmVkJylcbiAgICAgICAgICAgICAgICAvLyBleHBlY3Qoc2NoZW1hKS50by5ub3QuaGF2ZS5wcm9wZXJ0eSgnbmFtZScpXG4gICAgICAgICAgICBleHBlY3Qoc2NoZW1hKS50by5oYXZlLnByb3BlcnR5KCd0eXBlJywgJ29iamVjdCcpXG5cbiAgICAgICAgICAgIHZhciBwcm9wZXJ0aWVzO1xuXG4gICAgICAgICAgICAvLyByb290LnByb3BlcnRpZXNcbiAgICAgICAgICAgIHByb3BlcnRpZXMgPSBzY2hlbWEucHJvcGVydGllc1xuICAgICAgICAgICAgZXhwZWN0KHByb3BlcnRpZXMpLnRvLndpdGgubGVuZ3RoKDEpXG4gICAgICAgICAgICBleHBlY3QocHJvcGVydGllc1swXSkudG8uaGF2ZS5wcm9wZXJ0eSgnbmFtZScsICdhJylcbiAgICAgICAgICAgIGV4cGVjdChwcm9wZXJ0aWVzWzBdKS50by5oYXZlLnByb3BlcnR5KCd0eXBlJywgJ29iamVjdCcpXG5cbiAgICAgICAgICAgIC8vIHJvb3QuYS5wcm9wZXJ0aWVzXG4gICAgICAgICAgICBwcm9wZXJ0aWVzID0gcHJvcGVydGllc1swXS5wcm9wZXJ0aWVzXG4gICAgICAgICAgICBleHBlY3QocHJvcGVydGllcykudG8ud2l0aC5sZW5ndGgoMSlcbiAgICAgICAgICAgIGV4cGVjdChwcm9wZXJ0aWVzWzBdKS50by5oYXZlLnByb3BlcnR5KCduYW1lJywgJ2InKVxuICAgICAgICAgICAgZXhwZWN0KHByb3BlcnRpZXNbMF0pLnRvLmhhdmUucHJvcGVydHkoJ3R5cGUnLCAnb2JqZWN0JylcblxuICAgICAgICAgICAgLy8gcm9vdC5hLmIucHJvcGVydGllc1xuICAgICAgICAgICAgcHJvcGVydGllcyA9IHByb3BlcnRpZXNbMF0ucHJvcGVydGllc1xuICAgICAgICAgICAgZXhwZWN0KHByb3BlcnRpZXMpLnRvLndpdGgubGVuZ3RoKDEpXG4gICAgICAgICAgICBleHBlY3QocHJvcGVydGllc1swXSkudG8uaGF2ZS5wcm9wZXJ0eSgnbmFtZScsICdjJylcbiAgICAgICAgICAgIGV4cGVjdChwcm9wZXJ0aWVzWzBdKS50by5oYXZlLnByb3BlcnR5KCd0eXBlJywgJ29iamVjdCcpXG5cbiAgICAgICAgICAgIC8vIHJvb3QuYS5iLmMucHJvcGVydGllc1xuICAgICAgICAgICAgcHJvcGVydGllcyA9IHByb3BlcnRpZXNbMF0ucHJvcGVydGllc1xuICAgICAgICAgICAgZXhwZWN0KHByb3BlcnRpZXMpLnRvLndpdGgubGVuZ3RoKDEpXG4gICAgICAgICAgICBleHBlY3QocHJvcGVydGllc1swXSkudG8uaGF2ZS5wcm9wZXJ0eSgnbmFtZScsICdkJylcbiAgICAgICAgICAgIGV4cGVjdChwcm9wZXJ0aWVzWzBdKS50by5oYXZlLnByb3BlcnR5KCd0eXBlJywgJ29iamVjdCcpXG5cbiAgICAgICAgICAgIC8vIHJvb3QuYS5iLmMuZC5wcm9wZXJ0aWVzXG4gICAgICAgICAgICBwcm9wZXJ0aWVzID0gcHJvcGVydGllc1swXS5wcm9wZXJ0aWVzXG4gICAgICAgICAgICBleHBlY3QocHJvcGVydGllcykudG8ud2l0aC5sZW5ndGgoMClcbiAgICAgICAgfSlcblxuICAgIH0pXG5cbiAgICBkZXNjcmliZSgnQXJyYXknLCBmdW5jdGlvbigpIHtcbiAgICAgICAgZG9pdChbXG4gICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgWydmb28nLCAnYmFyJ11cbiAgICAgICAgICAgIF1cbiAgICAgICAgXSwgZnVuY3Rpb24oc2NoZW1hKSB7XG4gICAgICAgICAgICBleHBlY3Qoc2NoZW1hLm5hbWUpLnRvLmJlLmFuKCd1bmRlZmluZWQnKVxuICAgICAgICAgICAgICAgIC8vIGV4cGVjdChzY2hlbWEpLnRvLm5vdC5oYXZlLnByb3BlcnR5KCduYW1lJylcbiAgICAgICAgICAgIGV4cGVjdChzY2hlbWEpLnRvLmhhdmUucHJvcGVydHkoJ3R5cGUnLCAnYXJyYXknKVxuXG4gICAgICAgICAgICB2YXIgaXRlbXM7XG5cbiAgICAgICAgICAgIC8vIHJvb3QuaXRlbXNcbiAgICAgICAgICAgIGl0ZW1zID0gc2NoZW1hLml0ZW1zXG4gICAgICAgICAgICBleHBlY3QoaXRlbXMpLnRvLndpdGgubGVuZ3RoKDEpXG4gICAgICAgICAgICBleHBlY3QoaXRlbXNbMF0pLnRvLmhhdmUucHJvcGVydHkoJ3R5cGUnLCAnYXJyYXknKVxuXG4gICAgICAgICAgICAvLyByb290WzBdLml0ZW1zXG4gICAgICAgICAgICBpdGVtcyA9IGl0ZW1zWzBdLml0ZW1zXG4gICAgICAgICAgICBleHBlY3QoaXRlbXMpLnRvLndpdGgubGVuZ3RoKDEpXG4gICAgICAgICAgICBleHBlY3QoaXRlbXNbMF0pLnRvLmhhdmUucHJvcGVydHkoJ3R5cGUnLCAnYXJyYXknKVxuXG4gICAgICAgICAgICAvLyByb290WzBdWzBdLml0ZW1zXG4gICAgICAgICAgICBpdGVtcyA9IGl0ZW1zWzBdLml0ZW1zXG4gICAgICAgICAgICBleHBlY3QoaXRlbXMpLnRvLndpdGgubGVuZ3RoKDIpXG4gICAgICAgICAgICBleHBlY3QoaXRlbXNbMF0pLnRvLmhhdmUucHJvcGVydHkoJ3R5cGUnLCAnc3RyaW5nJylcbiAgICAgICAgICAgIGV4cGVjdChpdGVtc1sxXSkudG8uaGF2ZS5wcm9wZXJ0eSgndHlwZScsICdzdHJpbmcnKVxuICAgICAgICB9KVxuICAgIH0pXG5cbiAgICBkZXNjcmliZSgnU3RyaW5nIFJ1bGUnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgZG9pdCh7XG4gICAgICAgICAgICAnc3RyaW5nfDEtMTAnOiAn4piFJ1xuICAgICAgICB9LCBmdW5jdGlvbihzY2hlbWEpIHtcbiAgICAgICAgICAgIGV4cGVjdChzY2hlbWEubmFtZSkudG8uYmUuYW4oJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICAgICAgLy8gZXhwZWN0KHNjaGVtYSkudG8ubm90LmhhdmUucHJvcGVydHkoJ25hbWUnKVxuICAgICAgICAgICAgZXhwZWN0KHNjaGVtYSkudG8uaGF2ZS5wcm9wZXJ0eSgndHlwZScsICdvYmplY3QnKVxuXG4gICAgICAgICAgICB2YXIgcHJvcGVydGllcztcbiAgICAgICAgICAgIC8vIHJvb3QucHJvcGVydGllc1xuICAgICAgICAgICAgcHJvcGVydGllcyA9IHNjaGVtYS5wcm9wZXJ0aWVzXG4gICAgICAgICAgICBleHBlY3QocHJvcGVydGllcykudG8ud2l0aC5sZW5ndGgoMSlcbiAgICAgICAgICAgIGV4cGVjdChwcm9wZXJ0aWVzWzBdKS50by5oYXZlLnByb3BlcnR5KCd0eXBlJywgJ3N0cmluZycpXG4gICAgICAgICAgICBleHBlY3QocHJvcGVydGllc1swXS5ydWxlKS50by5oYXZlLnByb3BlcnR5KCdtaW4nLCAxKVxuICAgICAgICAgICAgZXhwZWN0KHByb3BlcnRpZXNbMF0ucnVsZSkudG8uaGF2ZS5wcm9wZXJ0eSgnbWF4JywgMTApXG4gICAgICAgIH0pXG4gICAgICAgIGRvaXQoe1xuICAgICAgICAgICAgJ3N0cmluZ3wzJzogJ3ZhbHVlJyxcbiAgICAgICAgfSwgZnVuY3Rpb24oc2NoZW1hKSB7XG4gICAgICAgICAgICBleHBlY3Qoc2NoZW1hLm5hbWUpLnRvLmJlLmFuKCd1bmRlZmluZWQnKVxuICAgICAgICAgICAgICAgIC8vIGV4cGVjdChzY2hlbWEpLnRvLm5vdC5oYXZlLnByb3BlcnR5KCduYW1lJylcbiAgICAgICAgICAgIGV4cGVjdChzY2hlbWEpLnRvLmhhdmUucHJvcGVydHkoJ3R5cGUnLCAnb2JqZWN0JylcblxuICAgICAgICAgICAgdmFyIHByb3BlcnRpZXM7XG4gICAgICAgICAgICAvLyByb290LnByb3BlcnRpZXNcbiAgICAgICAgICAgIHByb3BlcnRpZXMgPSBzY2hlbWEucHJvcGVydGllc1xuICAgICAgICAgICAgZXhwZWN0KHByb3BlcnRpZXMpLnRvLndpdGgubGVuZ3RoKDEpXG4gICAgICAgICAgICBleHBlY3QocHJvcGVydGllc1swXSkudG8uaGF2ZS5wcm9wZXJ0eSgndHlwZScsICdzdHJpbmcnKVxuICAgICAgICAgICAgZXhwZWN0KHByb3BlcnRpZXNbMF0ucnVsZSkudG8uaGF2ZS5wcm9wZXJ0eSgnbWluJywgMylcbiAgICAgICAgICAgIGV4cGVjdChwcm9wZXJ0aWVzWzBdLnJ1bGUubWF4KS50by5iZS5hbigndW5kZWZpbmVkJylcbiAgICAgICAgfSlcbiAgICB9KVxuXG59KSJdfQ==